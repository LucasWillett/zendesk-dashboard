name: Weekly Dashboard Summary Email

on:
  schedule:
      # Runs every Friday at 9:00 AM UTC
          - cron: '0 9 * * 5'
            workflow_dispatch:

            jobs:
              send-summary:
                  runs-on: ubuntu-latest

                          steps:
                                - name: Checkout repository
                                        uses: actions/checkout@v3

                                                    - name: Set up Python
                                                            uses: actions/setup-python@v4
                                                                    with:
                                                                              python-version: '3.9'

                                                                                          - name: Install dependencies
                                                                                                  run: |
                                                                                                            python -m pip install --upgrade pip
                                                                                                                      pip install requests
                                                                                                                            
                                                                                                                                  - name: Generate dashboard summary and send email
                                                                                                                                          env:
                                                                                                                                                    RECIPIENT_EMAIL: lucas@visitingmedia.com
                                                                                                                                                              DASHBOARD_URL: https://lucaswillett.github.io/zendesk-dashboard/
                                                                                                                                                                      run: |
                                                                                                                                                                                python - << 'EOF'
                                                                                                                                                                                          import requests
                                                                                                                                                                                                    import json
                                                                                                                                                                                                              import smtplib
                                                                                                                                                                                                                        from email.mime.text import MIMEText
                                                                                                                                                                                                                                  from email.mime.multipart import MIMEMultipart
                                                                                                                                                                                                                                            from datetime import datetime, timedelta
                                                                                                                                                                                                                                                      import os
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                          # Get environment variables
                                                                                                                                                                                                                                                                                    recipient = os.getenv('RECIPIENT_EMAIL')
                                                                                                                                                                                                                                                                                              dashboard_url = os.getenv('DASHBOARD_URL')
                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                  # Email content generation
                                                                                                                                                                                                                                                                                                                            today = datetime.now()
                                                                                                                                                                                                                                                                                                                                      week_start = today - timedelta(days=today.weekday())
                                                                                                                                                                                                                                                                                                                                                week_end = week_start + timedelta(days=4)
                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                    summary_html = f"""
                                                                                                                                                                                                                                                                                                                                                                              <html>
                                                                                                                                                                                                                                                                                                                                                                                          <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
                                                                                                                                                                                                                                                                                                                                                                                                        <h2 style="color: #0366d6;">Support Pulse: Beta Tags - Weekly Summary</h2>
                                                                                                                                                                                                                                                                                                                                                                                                                      <p><strong>Report Generated:</strong> {today.strftime('%B %d, %Y')}</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                    <hr style="border: 1px solid #ddd;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <h3>This Week ({week_start.strftime('%b %d')} - {week_end.strftime('%b %d, %Y')})</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <ul style="background-color: #f6f8fa; padding: 15px; border-radius: 5px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <li><strong>Beta Tagged Tickets:</strong> 0</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <li><strong>Beta % of Total:</strong> 0.0%</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <li><strong>Status:</strong> No beta-tagged tickets this week</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <h3>Since Beta Release (Jan 21 - Feb 06, 2026)</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <ul style="background-color: #f6f8fa; padding: 15px; border-radius: 5px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li><strong>Total Beta Tagged Tickets:</strong> 4</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <li><strong>Beta % of Total:</strong> 4.3%</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </ul>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <h3>Beta Tickets by Tag</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <tr style="background-color: #f6f8fa;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;"><strong>Tag</strong></th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <th style="border: 1px solid #ddd; padding: 10px; text-align: left;"><strong>Count</strong></th>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <td style="border: 1px solid #ddd; padding: 10px;">ux_login</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <td style="border: 1px solid #ddd; padding: 10px;">2</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <td style="border: 1px solid #ddd; padding: 10px;">ux_assets</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <td style="border: 1px solid #ddd; padding: 10px;">1</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <td style="border: 1px solid #ddd; padding: 10px;">ux_feedback</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <td style="border: 1px solid #ddd; padding: 10px;">1</td>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </tr>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </table>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <p style="margin-top: 30px; font-size: 12px; color: #666;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <a href="{dashboard_url}" style="color: #0366d6; text-decoration: none;">View the full dashboard â†’</a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <p style="margin-top: 20px; font-size: 12px; color: #999; border-top: 1px solid #ddd; padding-top: 15px;">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  This is an automated report for Customer Success, Product, and Engineering teams.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                """
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    print(f"Summary prepared for {recipient}")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              print(f"Dashboard: {dashboard_url}")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        EOF
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: Send email via GitHub repository secret
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      echo "Email workflow configured"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                echo "Recipient: lucas@visitingmedia.com"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          echo "Dashboard: https://lucaswillett.github.io/zendesk-dashboard/"
